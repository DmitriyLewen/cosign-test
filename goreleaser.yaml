project_name: cosign-test

builds:
  - id: main
    main: ./main.go
    binary: cosign-test

signs:
- cmd: cosign
  env:
  - COSIGN_EXPERIMENTAL=1
  signature: "${artifact}.sig"
  certificate: "${artifact}.pem"
  args:
    - "sign-blob"
    # `use-signing-config` is enabled by default since Cosign v2.6.0, and we can't use the --oidc-issue flag with it.
    # Therefore, we need to explicitly disable it.
    - "--use-signing-config=false"
    - "--oidc-issuer=https://token.actions.githubusercontent.com"
    - "--output-certificate=${certificate}"
    - "--output-signature=${signature}"
    - "${artifact}"
    - "--yes"
  artifacts: all
  output: true